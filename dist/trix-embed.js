var E=Object.defineProperty;var x=(t,e,i)=>e in t?E(t,e,{enumerable:!0,configurable:!0,writable:!0,value:i}):t[e]=i;var L=(t,e,i)=>(x(t,typeof e!="symbol"?e+"":e,i),i);function g(t,e){try{let i=new URL(String(t).trim());e(i.href)}catch(i){console.error("Error parsing URL!",t,i)}}function b(t){let e=[],i=document.createTreeWalker(t,NodeFilter.SHOW_TEXT,s=>s.nodeValue.includes("http")?NodeFilter.FILTER_ACCEPT:NodeFilter.FILTER_REJECT),n;for(;n=i.nextNode();)n.nodeValue.split(/\s+/).filter(s=>s.startsWith("http")).forEach(s=>g(s,a=>{e.includes(a)||e.push(a)}));return e}function R(t){let e=[];return t.src&&g(t.src,n=>e.push(n)),t.href&&g(t.href,n=>{e.includes(n)||e.push(n)}),t.querySelectorAll("[src], [href]").forEach(n=>{g(n.src||n.href,s=>{e.includes(s)||e.push(s)})}),e}function y(t){let e=R(t),i=b(t);return[...new Set([...e,...i])]}var C={avif:"image/avif",bmp:"image/bmp",gif:"image/gif",heic:"image/heic",heif:"image/heif",ico:"image/x-icon",jp2:"image/jp2",jpeg:"image/jpeg",jpg:"image/jpeg",jxr:"image/vnd.ms-photo",png:"image/png",svg:"image/svg+xml",tif:"image/tiff",tiff:"image/tiff",webp:"image/webp"};var S=C,U=["animate","animateMotion","animateTransform","area","audio","base","embed","feDisplacementMap","feImage","feTile","filter","font-face-uri","iframe","image","link","object","script","source","track","use","video"],M=["audio","embed","iframe","img","input","script","source","track","video","frame","frameset","object","picture","use"],_=U.concat(M);function v(t){try{t=new URL(t);let e=t.pathname.lastIndexOf(".");if(!e)return null;let i=t.pathname.substring(e+1);return S[i]}catch(e){console.error("Failed to detect media type!",t,e)}}var h=class{constructor(e){if(this.controller=e,this.hosts=e.hostsValue,e.templateValue){let i=document.getElementById(e.templateValue);i&&(this.template=i)}if(e.invalidTemplateValue){let i=document.getElementById(e.invalidTemplateValue);i&&(this.invalidTemplate=i)}if(e.validTemplateValue){let i=document.getElementById(e.validTemplateValue);i&&(this.validTemplate=i)}}render(e){let i=this.template.content.firstElementChild.cloneNode(!0),s=i.querySelector('[data-list="urls"]').querySelector('[data-item="url"]');return s.remove(),e.forEach(a=>{let l=s.cloneNode(!0),o=l.querySelector("[data-link]");o?(o.href=a,o.textContent=a,i.appendChild(l)):(l.textContent=a,i.appendChild(l))}),i.outerHTML}renderValid(e){let i=this.validTemplate.content.firstElementChild.cloneNode(!0),n=i.querySelector("iframe"),s=i.querySelector("img");return v(e)?(n.remove(),s.src=e):(s.remove(),n.src=e),i.outerHTML}renderInvalid(e){let i=this.invalidTemplate.content.firstElementChild.cloneNode(!0),n=i.querySelector('[data-list="hosts"]'),s=i.querySelector('[data-list="urls"]');return n&&(this.hosts.length?n.innerHTML=this.hosts.map(a=>`<li><code>${a}</code></li>`).join(""):n.innerHTML=`
          <li>
            <strong>Hosts not configured</strong>
            <p>Example Configuration</p>
            <pre><code>&lt;trix-editor data-trix-embed-hosts-value='["example.com", "test.com"]'&gt;</code></pre>
          </li>`),s&&(s.innerHTML=e.map(a=>`<li><code>${a}</code></li>`).join("")),i.outerHTML}set template(e){this._template=e}get template(){if(this._template)return this._template;let e=document.createElement("template");return e.innerHTML=`
      <div>
        <h1>External Links</h1>
        <ul data-list="urls">
          <li data-item="url">
            <a data-link target="_blank"></a>
          </li>
        </ul>
      </div>`,e}set validTemplate(e){this._validTemplate=e}get validTemplate(){if(this._validTemplate)return this._validTemplate;let e=document.createElement("template");return e.innerHTML="<div><iframe></iframe><img></img></div>",e}set invalidTemplate(e){this._invalidTemplate=e}get invalidTemplate(){if(this._invalidTemplate)return this._invalidTemplate;let e=document.createElement("template");return e.innerHTML=`
      <div style="background-color:ivory; border:solid 1px red; color:red; padding:10px;">
        <h1 slot="header">Unsupported copy/paste embed!</h1>
        <h2>The pasted content includes media from an unsupported host.</h2>
        <h3 style="color:green;">Supported Hosts</h3>
        <ul data-list="hosts" style="color:green;"></ul>
        <h2>Invalid URLs</h2>
        <ul data-list="urls"></ul>
      </div>`,e}};import{Controller as H}from"https://unpkg.com/@hotwired/stimulus@3.2.1/dist/stimulus.js";var u=class extends H{connect(){this.setupWeakSecurity()}paste(t){let{html:e,string:i,range:n}=t.paste,s=e||i||"",a=this.buildPastedTemplate(s),l=y(a.content.firstElementChild);if(!l.length)return;let o=l.filter(r=>v(r));Array.from(a.content.firstElementChild.querySelectorAll("iframe")).forEach(r=>{o.includes(r.src)||o.push(r.src)});let c=o.filter(r=>this.validateURL(r)),p=o.filter(r=>!c.includes(r)),m=l.filter(r=>!o.includes(r)),f=m.filter(r=>this.validateURL(r)),T=m.filter(r=>!f.includes(r)),d=new h(this);if(l.length===1&&this.validateURL(l[0]))return this.attachContent(d.renderValid(l[0])),setTimeout(()=>this.removePastedContent(n));if(!(o.length&&o.length===c.length&&!m.length)&&!(!o.length&&m.length&&!f.length)){if(!c.length)return p.length&&this.attachContent(d.renderInvalid(p.sort())),m.length&&this.attachContent(d.render(m.sort())),setTimeout(()=>this.removePastedContent(n));c.length&&c.forEach(r=>this.attachContent(d.renderValid(r))),f.length&&f.forEach(r=>this.attachContent(d.renderValid(r))),T.length&&this.attachContent(d.render(T.sort())),p.length&&this.attachContent(d.renderInvalid(p.sort())),setTimeout(()=>this.removePastedContent(n))}}buildPastedTemplate(t){let e=document.createElement("template");return e.innerHTML=`<div>${t.trim()}</div>`,e}removePastedContent(t){this.editor.setSelectedRange(t),this.editor.deleteInDirection("backward"),this.editor.moveCursorInDirection("forward")}validateURL(t){let e=new URL(t);return!!this.hostsValue.find(i=>e.host.includes(i))}attachContent(t){let e=new Trix.Attachment({content:t});this.editor.insertAttachment(e)}get editor(){return this.element.editor}setupWeakSecurity(){let t=this.element.closest("[id]"),e=t?t.id:"";this.hostsKey=`trix-embed-hosts-${e}`,this.rememberedHosts&&(this.hostsValue=this.rememberedHosts),this.rememberHosts()}rememberHosts(){sessionStorage.setItem(this.hostsKey,JSON.stringify(this.hostsValue))}get rememberedHosts(){let t=sessionStorage.getItem(this.hostsKey);return t?JSON.parse(t):null}};L(u,"values",{hosts:Array,template:String,validTemplate:String,invalidTemplate:String});var w={application:null};function V(t=w){let{application:e}=t;e.register("trix-embed",u)}var J={initialize:V};export{J as default};
//# sourceMappingURL=trix-embed.js.map
