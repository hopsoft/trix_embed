var G=Object.defineProperty,X=Object.defineProperties;var Q=Object.getOwnPropertyDescriptors;var j=Object.getOwnPropertySymbols;var Y=Object.prototype.hasOwnProperty,Z=Object.prototype.propertyIsEnumerable;var M=(i,e,t)=>e in i?G(i,e,{enumerable:!0,configurable:!0,writable:!0,value:t}):i[e]=t,k=(i,e)=>{for(var t in e||(e={}))Y.call(e,t)&&M(i,t,e[t]);if(j)for(var t of j(e))Z.call(e,t)&&M(i,t,e[t]);return i},U=(i,e)=>X(i,Q(e));var P=(i,e,t)=>(M(i,typeof e!="symbol"?e+"":e,t),t);var S={name:"AES-GCM",length:256},ee=!0,te=["encrypt","decrypt"];async function re(){let e=["encrypt","decrypt"];return await crypto.subtle.generateKey(S,!0,e)}async function ie(i){let e=await crypto.subtle.exportKey("jwk",i);return JSON.stringify(e)}async function O(i){let e=JSON.parse(i);return await crypto.subtle.importKey("jwk",e,S,ee,te)}async function ne(i,e){let t=new TextEncoder().encode(String(i)),n=crypto.getRandomValues(new Uint8Array(12)),r=await crypto.subtle.encrypt(U(k({},S),{iv:n}),e,t),o={ciphertext:btoa(String.fromCharCode(...new Uint8Array(r))),iv:btoa(String.fromCharCode(...n))};return btoa(JSON.stringify(o))}async function oe(i,e){let t=JSON.parse(atob(i)),n=new Uint8Array(atob(t.ciphertext).split("").map(s=>s.charCodeAt(0))),r=new Uint8Array(atob(t.iv).split("").map(s=>s.charCodeAt(0))),o=await crypto.subtle.decrypt(U(k({},S),{iv:r}),e,n);return new TextDecoder().decode(o)}async function T(){let i=await re(),e=await ie(i);return btoa(e)}async function b(i,e=[]){let t=await O(atob(i));return Promise.all(e.map(n=>ne(n,t)))}async function K(i,e=[]){let t=await O(atob(i));return Promise.all(e.map(n=>oe(n,t)))}async function V(i=[]){let e=await T(),t=await b(e,i);return console.log(`data-trix-embed-key-value="${e}"`),console.log(`data-trix-embed-hosts-value='${JSON.stringify(t)}'`),{key:e,encryptedValues:t}}function h(i,e=t=>{}){try{let t=new URL(String(i).trim());return e&&e(t),t}catch(t){console.info(`Failed to parse URL! value='${i}']`)}return null}function $(i,e=t=>{}){let t=null;return h(i,n=>t=n.host),t&&e&&e(t),t}function se(i){let e=[],t=document.createTreeWalker(i,NodeFilter.SHOW_TEXT,r=>r.nodeValue.includes("http")?NodeFilter.FILTER_ACCEPT:NodeFilter.FILTER_REJECT),n;for(;n=t.nextNode();)n.nodeValue.split(/\s+/).filter(r=>r.startsWith("http")).forEach(r=>h(r,o=>{e.includes(o.href)||e.push(o.href)}));return e}function ae(i){let e=[];return i.src&&h(i.src,n=>e.push(n.href)),i.href&&h(i.href,n=>{e.includes(n.href)||e.push(n.href)}),i.querySelectorAll("[src], [href]").forEach(n=>{h(n.src||n.href,r=>{e.includes(r.href)||e.push(r.href)})}),e}function N(i,e=[]){let t=!1;return $(i,n=>t=!!e.find(r=>n.includes(r))),t}function I(i){return i.reduce((e,t)=>($(t,n=>{e.includes(n)||e.push(n)}),e),[])}function q(i){let e=ae(i),t=se(i);return[...new Set([...e,...t])]}var D={avif:"image/avif",bmp:"image/bmp",gif:"image/gif",heic:"image/heic",heif:"image/heif",ico:"image/x-icon",jp2:"image/jp2",jpeg:"image/jpeg",jpg:"image/jpeg",jxr:"image/vnd.ms-photo",png:"image/png",svg:"image/svg+xml",tif:"image/tiff",tiff:"image/tiff",webp:"image/webp"};var ce=D,le=["animate","animateMotion","animateTransform","area","audio","base","embed","feDisplacementMap","feImage","feTile","filter","font-face-uri","iframe","image","link","object","script","source","track","use","video"],de=["audio","embed","iframe","img","input","script","source","track","video","frame","frameset","object","picture","use"],F=le.concat(de);function J(i){return!!Object.values(D).find(e=>e===R(i))}function R(i){let e;if(h(i,r=>e=r),!e)return null;let t=e.pathname.lastIndexOf(".");if(!t)return null;let n=e.pathname.substring(t+1);return ce[n]}var v=class{constructor(e){this.controller=e,e.element.addEventListener("trix-file-accept",t=>t.preventDefault())}protect(){if(!this.controller.formElement)return;let e=this.controller.formElement,t=this.controller.inputElement;document.addEventListener("submit",r=>{let o=r.target.closest("form");o&&o.action===e.action&&o.method===e.method&&o!==e&&r.preventDefault()},!0),new MutationObserver((r,o)=>{r.forEach(s=>{var u;let{addedNodes:c,target:a,type:p}=s;switch(p){case"attributes":((u=a.closest("form"))==null?void 0:u.action)===e.action&&(a.id===t.id||a.name===t.name)&&a.remove();break;case"childList":c.forEach(m=>{var f;m.nodeType===Node.ELEMENT_NODE&&(m.tagName.match(/^form$/i)&&m.action===e.action&&m.remove(),((f=a.closest("form"))==null?void 0:f.action)===e.action&&(m.id===t.id||m.name===t.name)&&m.remove())});break}})}).observe(document.body,{attributeFilter:["id","name"],attributes:!0,childList:!0,subtree:!0})}cleanup(){let e=this.controller.element,t=this.controller.inputElement,n=this.controller.toolbarElement;t==null||t.remove(),n==null||n.remove(),e==null||e.remove()}};var E=class{constructor(e){var t;this.controller=e,this.base=this.obfuscate([location.pathname,(t=this.controller.element.closest("[id]"))==null?void 0:t.id].join("/"))}split(e){let t=Math.ceil(e.length/2);return[e.slice(0,t),e.slice(t)]}obfuscate(e){var r;let t=[...e].map(o=>o.charCodeAt(0));return[(r=this.split(t)[1])==null?void 0:r.reverse(),t[0]].flat().join("")}read(e){return sessionStorage.getItem(this.generateStorageKey(e))}write(e,t){return sessionStorage.setItem(this.generateStorageKey(e),t)}remove(e){return sessionStorage.removeItem(this.generateStorageKey(e))}generateStorageKey(e){let t=[...this.obfuscate(e)],[n,r]=this.split(t);return btoa(`${n}/${this.base}/${r}`)}};var me={header:"<h1></h1>",iframe:"<iframe></iframe>",image:"<img></img>",error:`
    <div>
      <h1>Copy/Paste Info</h1>
      <h3>The pasted content includes media from unsupported hosts.</h3>

      <h2>Prohibited Hosts / Domains</h2>
      <ul data-list="prohibited-hosts">
        <li>Media is only supported from allowed hosts.</li>
      </ul>

      <h2>Allowed Hosts / Domains</h2>
      <ul data-list="allowed-hosts">
        <li>Allowed hosts not configured.</li>
      </ul>
    </div>
  `,exception:`
    <div style='background-color:lightyellow; color:red; border:solid 1px red; padding:20px;'>
      <h1>Unhandled Exception!</h1>
      <p>Show a programmer the message below.</p>
      <pre style="background-color:darkslategray; color:whitesmoke; padding:10px;"><code></code></pre>
    </div>
  `};function z(i){let e=document.createElement("template");return e.innerHTML=me[i],e}var w=class{constructor(e){this.controller=e,this.initializeTempates()}initializeTempates(){["error","exception","header","iframe","image"].forEach(t=>this.initializeTemplate(t))}initializeTemplate(e){let t;this.controller[`has${e.charAt(0).toUpperCase()+e.slice(1)}TemplateValue`]&&(t=document.getElementById(this.controller[`${e}TemplateValue`])),this[`${e}Template`]=t||z(e)}renderHeader(e){let t=this.headerTemplate.content.firstElementChild.cloneNode(!0),n=t.tagName.match(/h1/i)?t:t.querySelector("h1");return n.innerHTML=e,t.outerHTML}renderLinks(e=["https://example.com","https://test.com"]){return e=e.filter(n=>{let r=!1;return h(n,o=>r=!0),r}).sort(),e.length?`<ul>${e.map(n=>`<li><a href='${n}'>${n}</a></li>`).join("")}</ul><br>`:void 0}renderEmbed(e="https://example.com"){let t;if(J(e)){t=this.imageTemplate.content.firstElementChild.cloneNode(!0);let n=t.tagName.match(/img/i)?t:t.querySelector("img");n.src=e}else{t=this.iframeTemplate.content.firstElementChild.cloneNode(!0);let n=t.tagName.match(/iframe/i)?t:t.querySelector("iframe");n.src=e}return t.outerHTML}renderEmbeds(e=["https://example.com","https://test.com"]){if(e!=null&&e.length)return e.map(t=>this.renderEmbed(t))}renderErrors(e=["https://example.com","https://test.com"],t=[]){if(!(e!=null&&e.length))return;let n=this.errorTemplate.content.firstElementChild.cloneNode(!0),r=n.querySelector('[data-list="prohibited-hosts"]'),o=n.querySelector('[data-list="allowed-hosts"]');if(r){let s=I(e).sort();s.length&&(r.innerHTML=s.map(c=>`<li>${c}</li>`).join(""))}return o&&t.length&&(o.innerHTML=t.map(s=>`<li>${s}</li>`).join("")),n.outerHTML}renderException(e){let t=this.exceptionTemplate.content.firstElementChild.cloneNode(!0),n=t.querySelector("code");return n.innerHTML=e.message,t.outerHTML}};var ue={Controller:null,Trix:null};function B(i=ue){var n;let{Controller:e,Trix:t}=i;return n=class extends e{async connect(){var r;this.store=new E(this),this.guard=new v(this),await this.rememberConfig(),this.paranoid&&this.guard.protect(),(r=this.toolbarElement.querySelector('[data-trix-button-group="file-tools"]'))==null||r.remove(),window.addEventListener("beforeunload",()=>this.disconnect())}disconnect(){this.paranoid&&this.guard.cleanup(),this.forgetConfig()}async paste(r){let{html:o,string:s,range:c}=r.paste,a=o||s||"",p=this.buildPastedTemplate(a),u=p.content.firstElementChild,f=this.sanitizePastedElement(u).innerHTML.trim(),x=q(u);if(!x.length)return;r.preventDefault(),this.editor.setSelectedRange(c);let A=await this.hosts,g=new w(this);try{let y=x.filter(l=>R(l));Array.from(p.content.firstElementChild.querySelectorAll("iframe")).forEach(l=>{y.includes(l.src)||y.push(l.src)});let C=y.filter(l=>N(l,A)),W=y.filter(l=>!C.includes(l)),H=x.filter(l=>!y.includes(l)),L=H.filter(l=>N(l,A)),_=H.filter(l=>!L.includes(l)),d;if(d=W,d.length&&await this.insert(g.renderErrors(d,A.sort())),d=_,d.length&&(await this.insert(g.renderHeader("Pasted URLs")),await this.insert(g.renderLinks(d),{disposition:"inline"})),d=C,d.length&&(d.length>1&&await this.insert(g.renderHeader("Embedded Media")),await this.insert(g.renderEmbeds(d))),d=L,d.length&&await this.insert(g.renderEmbeds(L)),x.length===1||C[0]===f||x.length===1||L[0]===f)return;f.length&&(await this.insert(g.renderHeader("Pasted Content",f)),this.editor.insertLineBreak(),this.insert(f,{disposition:"inline"}))}catch(y){this.insert(g.renderException(y))}}buildPastedTemplate(r){let o=document.createElement("template");return o.innerHTML=`<div>${r.trim()}</div>`,o}sanitizePastedElement(r){r=r.cloneNode(!0),r.querySelectorAll(F.join(", ")).forEach(c=>c.remove());let o=r.querySelectorAll("*"),s=r.innerHTML.match(/\r\n|\n|\r/g)||[];return(s.length?o.length/s.length:0)<=.1&&(r.innerHTML=r.innerHTML.replaceAll(/\r\n|\n|\r/g,"<br>")),r}insertAttachment(r,o={delay:0}){let{delay:s}=o;return new Promise(c=>{setTimeout(()=>{let a=new t.Attachment({content:r,contentType:"application/vnd.trix-embed.html"});this.editor.insertAttachment(a),c()},s)})}insertHTML(r,o={delay:0}){let{delay:s}=o;return new Promise(c=>{setTimeout(()=>{this.editor.insertHTML(r),this.editor.moveCursorInDirection("forward"),this.editor.insertLineBreak(),this.editor.moveCursorInDirection("backward"),c()},s)})}insert(r,o={delay:0,disposition:"attachment"}){let{delay:s,disposition:c}=o;return r!=null&&r.length?new Promise(a=>{setTimeout(()=>{if(typeof r=="string")return c==="inline"?this.insertHTML(r,{delay:s}).then(a):this.insertAttachment(r,{delay:s}).then(a);if(Array.isArray(r))return c==="inline"?r.reduce((p,u,m)=>p.then(this.insertHTML(u,{delay:s})),Promise.resolve()).then(a):r.reduce((p,u,m)=>p.then(this.insertAttachment(u,{delay:s})),Promise.resolve()).then(a);a()})}):Promise.resolve()}get editor(){return this.element.editor}get toolbarElement(){let r=this.element.previousElementSibling;return r!=null&&r.tagName.match(/trix-toolbar/i)?r:null}get inputElement(){return document.getElementById(this.element.getAttribute("input"))}get formElement(){return this.element.closest("form")}get paranoid(){return!!this.store.read("paranoid")}get key(){try{return JSON.parse(this.store.read("key"))[2]}catch(r){}}get hosts(){try{return K(this.key,JSON.parse(this.store.read("hosts")))}catch(r){return[]}}get reservedDomains(){return["example.com","test.com","invalid.com","example.cat","nic.example","example.co.uk"]}async rememberConfig(){let r=await T(),o=await b(r,this.reservedDomains),s=await b(r,this.hostsValue);this.store.write("key",JSON.stringify([o[0],o[1],r,o[2]])),this.element.removeAttribute("data-trix-embed-key-value"),this.store.write("hosts",JSON.stringify(s)),this.element.removeAttribute("data-trix-embed-hosts-value"),this.paranoidValue!==!1&&(this.store.write("paranoid",JSON.stringify(o.slice(3))),this.element.removeAttribute("data-trix-embed-paranoid"))}forgetConfig(){this.store.remove("key"),this.store.remove("hosts"),this.store.remove("paranoid")}},P(n,"values",{validTemplate:String,errorTemplate:String,headerTemplate:String,iframeTemplate:String,imageTemplate:String,hosts:Array,paranoid:{type:Boolean,default:!0}}),n}var he={application:null,Controller:null,Trix:null};function pe(i=he){let{application:e,Controller:t,Trix:n}=i;e.register("trix-embed",B({Controller:t,Trix:n}))}self.TrixEmbed={initialize:pe,generateKey:T,encryptValues:b,generateKeyAndEncryptValues:V};var Ie=self.TrixEmbed;export{Ie as default};
