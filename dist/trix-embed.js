var x=Object.defineProperty;var E=(i,e,t)=>e in i?x(i,e,{enumerable:!0,configurable:!0,writable:!0,value:t}):i[e]=t;var v=(i,e,t)=>(E(i,typeof e!="symbol"?e+"":e,t),t);function f(i,e){try{let t=new URL(String(i).trim());e(t.href)}catch(t){console.error("Error parsing URL!",i,t)}}function y(i){let e=[],t=document.createTreeWalker(i,NodeFilter.SHOW_TEXT,a=>a.nodeValue.includes("http")?NodeFilter.FILTER_ACCEPT:NodeFilter.FILTER_REJECT),n;for(;n=t.nextNode();)n.nodeValue.split(/\s+/).filter(a=>a.startsWith("http")).forEach(a=>f(a,s=>{e.includes(s)||e.push(s)}));return e}function C(i){let e=[];return i.src&&f(i.src,n=>e.push(n)),i.href&&f(i.href,n=>{e.includes(n)||e.push(n)}),i.querySelectorAll("[src], [href]").forEach(n=>{f(n.src||n.href,a=>{e.includes(a)||e.push(a)})}),e}function T(i){let e=C(i),t=y(i);return[...e,...t]}var R={avif:"image/avif",bmp:"image/bmp",gif:"image/gif",heic:"image/heic",heif:"image/heif",ico:"image/x-icon",jp2:"image/jp2",jpeg:"image/jpeg",jpg:"image/jpeg",jxr:"image/vnd.ms-photo",png:"image/png",svg:"image/svg+xml",tif:"image/tiff",tiff:"image/tiff",webp:"image/webp"};var U=R,b=["animate","animateMotion","animateTransform","area","audio","base","embed","feDisplacementMap","feImage","feTile","filter","font-face-uri","iframe","image","link","object","script","source","track","use","video"],M=["audio","embed","iframe","img","input","script","source","track","video","frame","frameset","object","picture","use"],k=b.concat(M);function g(i){try{i=new URL(i);let e=i.pathname.lastIndexOf(".");if(!e)return null;let t=i.pathname.substring(e+1);return U[t]}catch(e){console.error("Failed to detect media type!",i,e)}}var c=class{constructor(e){if(this.controller=e,this.hosts=e.hostsValue,e.templateValue){let t=document.getElementById(e.templateValue);t&&(this.template=t)}if(e.invalidTemplateValue){let t=document.getElementById(e.invalidTemplateValue);t&&(this.invalidTemplate=t)}if(e.validTemplateValue){let t=document.getElementById(e.validTemplateValue);t&&(this.validTemplate=t)}}render(e){let t=this.template.content.firstElementChild.cloneNode(!0),a=t.querySelector('[data-list="urls"]').querySelector('[data-item="url"]');return a.remove(),e.forEach(s=>{let o=a.cloneNode(!0),l=o.querySelector("[data-link]");l?(l.href=s,l.textContent=s,t.appendChild(o)):(o.textContent=s,t.appendChild(o))}),t.outerHTML}renderValid(e){let t=this.validTemplate.content.firstElementChild.cloneNode(!0),n=t.querySelector("iframe"),a=t.querySelector("img");return g(e)?(n.remove(),a.src=e):(a.remove(),n.src=e),t.outerHTML}renderInvalid(e){let t=this.invalidTemplate.content.firstElementChild.cloneNode(!0),n=t.querySelector('[data-list="hosts"]'),a=t.querySelector('[data-list="urls"]');return n&&(this.hosts.length?n.innerHTML=this.hosts.map(s=>`<li><code>${s}</code></li>`).join(""):n.innerHTML=`
          <li>
            <strong>Hosts not configured</strong>
            <p>Example Configuration</p>
            <pre><code>&lt;trix-editor data-trix-embed-hosts-value='["example.com", "test.com"]'&gt;</code></pre>
          </li>`),a&&(a.innerHTML=e.map(s=>`<li><code>${s}</code></li>`).join("")),t.outerHTML}set template(e){this._template=e}get template(){if(this._template)return this._template;let e=document.createElement("template");return e.innerHTML=`
      <div>
        <h1>External Links</h1>
        <ul data-list="urls">
          <li data-item="url">
            <a data-link target="_blank"></a>
          </li>
        </ul>
      </div>`,e}set validTemplate(e){this._validTemplate=e}get validTemplate(){if(this._validTemplate)return this._validTemplate;let e=document.createElement("template");return e.innerHTML="<div><iframe></iframe><img></img></div>",e}set invalidTemplate(e){this._invalidTemplate=e}get invalidTemplate(){if(this._invalidTemplate)return this._invalidTemplate;let e=document.createElement("template");return e.innerHTML=`
      <div style="background-color:ivory; border:solid 1px red; color:red; padding:10px;">
        <h1 slot="header">Unsupported copy/paste embed!</h1>
        <h2>The pasted content includes media from an unsupported host.</h2>
        <h3 style="color:green;">Supported Hosts</h3>
        <ul data-list="hosts" style="color:green;"></ul>
        <h2>Invalid URLs</h2>
        <ul data-list="urls"></ul>
      </div>`,e}};import{Controller as S}from"https://unpkg.com/@hotwired/stimulus@3.2.1/dist/stimulus.js";var p=class extends S{paste(i){let{html:e,string:t,range:n}=i.paste,a=e||t||"",s=this.buildPastedTemplate(a),o=T(s.content.firstElementChild);if(!o.length)return;let l=o.filter(r=>g(r));Array.from(s.content.firstElementChild.querySelectorAll("iframe")).forEach(r=>{l.includes(r.src)||l.push(r.src)});let u=l.filter(r=>this.validateURL(r)),h=l.filter(r=>!u.includes(r)),d=o.filter(r=>!l.includes(r)),L=d.filter(r=>this.validateURL(r)),I=d.filter(r=>!L.includes(r)),m=new c(this);if(o.length===1&&this.validateURL(o[0]))return this.attachContent(m.renderValid(o[0])),setTimeout(()=>this.removePastedContent(n));if(l.length&&!(l.length===u.length&&!d.length)){if(!u.length)return h.length&&this.attachContent(m.renderInvalid(h.sort())),d.length&&this.attachContent(m.render(d.sort())),setTimeout(()=>this.removePastedContent(n));u.forEach(r=>this.attachContent(m.renderValid(r))),this.attachContent(m.render(d.sort())),h.length&&this.attachContent(m.renderInvalid(h.sort())),setTimeout(()=>this.removePastedContent(n))}}buildPastedTemplate(i){let e=document.createElement("template");return e.innerHTML=`<div>${i.trim()}</div>`,e}removePastedContent(i){this.editor.setSelectedRange(i),this.editor.deleteInDirection("backward"),this.editor.moveCursorInDirection("forward")}validateURL(i){let e=new URL(i);return!!this.hostsValue.find(t=>e.host.includes(t))}attachContent(i){let e=new Trix.Attachment({content:i});this.editor.insertAttachment(e)}get editor(){return this.element.editor}};v(p,"values",{hosts:Array,template:String,validTemplate:String,invalidTemplate:String});var w={application:null};function H(i=w){let{application:e}=i;e.register("trix-embed",p)}var z={initialize:H};export{z as default};
//# sourceMappingURL=trix-embed.js.map
