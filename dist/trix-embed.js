var E=Object.defineProperty;var C=(t,e,i)=>e in t?E(t,e,{enumerable:!0,configurable:!0,writable:!0,value:i}):t[e]=i;var L=(t,e,i)=>(C(t,typeof e!="symbol"?e+"":e,i),i);function h(t,e){try{let i=new URL(String(t).trim());e(i.href)}catch(i){console.error("Error parsing URL!",t,i)}}function w(t){let e=[],i=document.createTreeWalker(t,NodeFilter.SHOW_TEXT,a=>a.nodeValue.includes("http")?NodeFilter.FILTER_ACCEPT:NodeFilter.FILTER_REJECT),r;for(;r=i.nextNode();)r.nodeValue.split(/\s+/).filter(a=>a.startsWith("http")).forEach(a=>h(a,s=>{e.includes(s)||e.push(s)}));return e}function M(t){let e=[];return t.src&&h(t.src,r=>e.push(r)),t.href&&h(t.href,r=>{e.includes(r)||e.push(r)}),t.querySelectorAll("[src], [href]").forEach(r=>{h(r.src||r.href,a=>{e.includes(a)||e.push(a)})}),e}function R(t){let e=M(t),i=w(t);return[...e,...i]}var S={avif:"image/avif",bmp:"image/bmp",gif:"image/gif",heic:"image/heic",heif:"image/heif",ico:"image/x-icon",jp2:"image/jp2",jpeg:"image/jpeg",jpg:"image/jpeg",jxr:"image/vnd.ms-photo",mp3:"audio/mpeg",mp4:"video/mp4",ogg:"audio/ogg",ogv:"video/ogg",png:"image/png",svg:"image/svg+xml",tif:"image/tiff",tiff:"image/tiff",wav:"audio/wav",webm:"video/webm",webp:"image/webp"},j=["animate","animateMotion","animateTransform","area","audio","base","embed","feDisplacementMap","feImage","feTile","filter","font-face-uri","iframe","image","link","object","script","source","track","use","video"],F=["audio","embed","iframe","img","input","script","source","track","video","frame","frameset","object","picture","use"],k=j.concat(F);function U(t){try{t=new URL(t);let e=t.pathname.lastIndexOf(".");if(!e)return null;let i=t.pathname.substring(e+1);return S[i]}catch(e){console.error("Failed to detect media type!",t,e)}}var m=class{constructor(e){if(this.controller=e,this.hosts=e.hostsValue,e.invalidTemplateValue){let i=document.getElementById(e.invalidTemplateValue);i&&(this.invalidTemplate=i)}if(e.validTemplateValue){let i=document.getElementById(e.validTemplateValue);i&&(this.validTemplate=i)}}renderValid(e){let i=this.validTemplate.content.firstElementChild.cloneNode(!0),r=i.querySelector("iframe");return r.src=e,i.outerHTML}renderInvalid(e){let i=this.invalidTemplate.content.firstElementChild.cloneNode(!0),r=i.querySelector('[data-list="hosts"]'),a=i.querySelector('[data-list="urls"]');return r&&(r.innerHTML=this.hosts.map(s=>`<li><code>${s}</code></li>`).join("")),a&&(a.innerHTML=e.map(s=>`<li><code>${s}</code></li>`).join("")),i.outerHTML}set validTemplate(e){this._validTemplate=e}get validTemplate(){if(this._validTemplate)return this._validTemplate;let e=document.createElement("template");return e.innerHTML=`
      <div style="border:solid 1px gainsboro; border-radius:5px; display:inline-block; padding:10px;">
        <iframe
          allow=""
          allowfullscreen
          frameborder="0"
          loading="lazy"
          referrerpolicy="no-referrer"
          scrolling="no"
          width="854"
          height="480"
          style="border:solid 1px gainsboro;">
        </iframe>
      </div>`,e}set invalidTemplate(e){this._invalidTemplate=e}get invalidTemplate(){if(this._invalidTemplate)return this._invalidTemplate;let e=document.createElement("template");return e.innerHTML=`
      <div style="background-color:ivory; border:solid 1px red; color:red; padding:10px;">
        <h1 slot="header">Unsupported copy/paste embed!</h1>
        <p>The pasted content includes media from an unsupported host.</p>
        <h2>Supported Hosts</h2>
        <ul data-list="hosts"></ul>
        <h2>Pasted URLs</h2>
        <ul data-list="urls"></ul>
      </div>`,e}};import{Controller as V}from"https://unpkg.com/@hotwired/stimulus@3.2.1/dist/stimulus.js";var u=class extends V{paste(t){let{html:e,string:i,range:r}=t.paste,a=e||i||"",s=this.buildPastedTemplate(a),c=R(s.content.firstElementChild);if(!c.length)return;let o=Array.from(s.content.firstElementChild.querySelectorAll("iframe")).map(n=>n.src),g=o.filter(n=>this.validateURL(n)),b=o.filter(n=>!g.includes(n)),l=c.filter(n=>U(n)&&!o.includes(n)),f=l.filter(n=>this.validateURL(n)),x=l.filter(n=>!f.includes(n)),d=c.filter(n=>!o.includes(n)&&!l.includes(n)),H=d.filter(n=>this.validateURL(n)),v=[...g,...f],y=[...b,...x],p=new m(this),T=!o.length&&!l.length&&d.length===1&&this.validateURL(d[0])?d[0]:null;if(T)return this.attachContent(p.renderValid(T)),setTimeout(()=>this.removePastedContent(r));if(!(!o.length&&!l.length)&&!(!o.length&&f.length===l.length)){if(!v.length)return this.removePastedContent(r),this.attachContent(p.renderInvalid(c.sort()));v.forEach(n=>this.attachContent(p.renderValid(n))),d.length&&this.attachContent(d.sort().join("<br>")),y.length&&this.attachContent(p.renderInvalid(c.sort())),setTimeout(()=>this.removePastedContent(r))}}buildPastedTemplate(t){let e=document.createElement("template");return e.innerHTML=`<div>${t.trim()}</div>`,e}removePastedContent(t){this.editor.setSelectedRange(t),this.editor.deleteInDirection("backward"),this.editor.moveCursorInDirection("forward")}validateURL(t){let e=new URL(t);return!!this.hostsValue.find(i=>e.host.includes(i))}attachContent(t){let e=new Trix.Attachment({content:t});this.editor.insertAttachment(e)}get editor(){return this.element.editor}};L(u,"values",{hosts:Array,validTemplate:String,invalidTemplate:String});export{u as TrixEmbedController};
//# sourceMappingURL=trix-embed.js.map
