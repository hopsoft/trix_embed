var m=Object.defineProperty;var u=(t,e,n)=>e in t?m(t,e,{enumerable:!0,configurable:!0,writable:!0,value:n}):t[e]=n;var d=(t,e,n)=>(u(t,typeof e!="symbol"?e+"":e,n),n);import{Controller as f}from"https://unpkg.com/@hotwired/stimulus@3.2.1/dist/stimulus.js";var a=class extends f{paste(t){let{html:e,string:n,range:i}=t.paste,l=e||n||"",s=this.buildPastedTemplate(l),c=this.extractContent(s),o=this.extractMediaURLs(s);if(!this.validatePasted(s,o))return o.length===0?void 0:this.createContentAttachment(this.invalidMessage,i);if(!this.template)return this.createContentAttachment(c,i);let r=this.template.content.firstElementChild.cloneNode(!0),h=r.tagName.match(/iframe/i)?r:r.querySelector("iframe");h.src=this.extractMediaURLs(s)[0],this.createContentAttachment(r.outerHTML,i)}buildPastedTemplate(t){let e=document.createElement("template");return e.innerHTML=t.trim(),e}validatePasted(t,e){return t.content.childNodes.length!==1||!this.validNodeTypes.includes(t.content.firstChild.nodeType)?!1:e.length===e.filter(n=>this.validateURL(n))}validateURL(t){return!!this.validHosts.find(e=>t.includes(e))}extractContent(t){switch(t.content.firstChild.nodeType){case Node.TEXT_NODE:return t.content.textContent;case Node.ELEMENT_NODE:return t.content.firstElementChild.outerHTML;default:return""}}sanitizeURL(t){return t=String(t).trim(),t.startsWith("http")?t:null}extractMediaURLs(t){let e=[];switch(t.content.firstChild.nodeType){case Node.TEXT_NODE:e.push(this.sanitizeURL(t.content.textContent));break;case Node.ELEMENT_NODE:t.content.querySelectorAll("audio, embed, frame, iframe, img, video").forEach(i=>e.push(this.sanitizeURL(i.src||i.href)));break}return e.filter(n=>n)}createContentAttachment(t,e){console.log("createContentAttachment",t);let n=new Trix.Attachment({content:t,contentType:"text/html"});console.log("attachment",n),this.editor.insertAttachment(n),setTimeout(()=>{this.editor.setSelectedRange(e),this.editor.deleteInDirection("backward"),this.editor.moveCursorInDirection("forward")})}get validNodeTypes(){return[Node.ELEMENT_NODE,Node.TEXT_NODE]}get validHosts(){return this.hostsValue}get invalidMessage(){return`${this.invalidMessageValue} <code>${this.hostsValue.join(", ")}</code>`}get template(){return this.hasTemplateValue?document.getElementById(this.templateValue):null}get editor(){return this.element.editor}};d(a,"values",{hosts:Array,template:String,invalidMessage:{type:String,default:"<strong>The pasted content is not supported!</strong><br><br>Media is limited to:"}});Trix.config.attachments["text/html"]={caption:{name:!0}};export{a as TrixEmbedController};
//# sourceMappingURL=trix-embed.js.map
